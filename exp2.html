<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonetics experiment</title>
    <script src="dist/jspsych.js"></script>
    <link href="dist/jspsych.css" rel="stylesheet" type="text/css" />
    <script src="dist/plugin-html-keyboard-response.js"></script>
    <script src="dist/plugin-audio-button-response.js"></script>
    <script src="dist/plugin-preload.js"></script>
    <script src="dist/plugin-html-button-response.js"></script>
    <script src="dist/plugin-survey-html-form.js"></script>
</head>
<body></body>
<script> 
    const jsPsych = initJsPsych({
        on_finish: function() {
            jsPsych.data.get().localSave('csv', 'exp_data.csv')
        }
    });

    var timeline = []

    const consentform = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
          <h2 style="text-align:center;">Consent</h2>
          <p style="font-size: 110%;">
            You are being invited to take part in a research study for a Linguistics master's degree at the Université Paris Cité.</p>
            <p>Participation is voluntary and you can withdraw at any time.</p>
            

          <p style="font-size: 110%;">
            By clicking 'I agree', you indicate that:
          </p>

          <ul style="font-size: 110%;">
            <p>You voluntarily agree to participate.</p>
            <p>You have read and understood the information above.</p>
          </ul>

          <p style="font-size: 110%; text-align:center; margin-top: 20px;">
            If you agree to take part, click on the button below:
          </p>
        `,
        choices: ["I agree"],
        data: { label: "consent" }
    };
    timeline.push(consentform);

    const instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus:
         `<h2 style="text-align:center;">Instructions</h2>
          <p>Welcome to experiment.</p>
          <p>For each trial: You will hear one audio stimulus and two written word options will appear on the screen.</p>
          <p>Your task is to select the word that best matches what you heard.</p>
          <p>Before the main experiment, you will complete a short familiarization phase to help you understand the task.</p>
          <p> Once the experiment is finished, you will be asked to provide some basic demographic information. </p>
          <p>As this is a pilot study, you will then be prompted to download your response file and send it to the researcher.</p>
          <p>Press any key to begin.</p>
        `,
    };
    timeline.push(instructions);

    
    var preload = {
        type: jsPsychPreload,
        audio: [
            'sound/la.mp3', 'sound/la2.mp3',
            'sound/va.mp3', 'sound/va2.mp3',
            'sound/si.mp3', 'sound/sim.mp3',
            'sound/ri.mp3', 'sound/rim.mp3',
            'sound/nu.mp3', 'sound/num.mp3',
            'sound/tu.mp3', 'sound/tum.mp3',
            'sound/se.mp3', 'sound/sem.mp3',
            'sound/de.mp3', 'sound/dem.mp3',
            'sound/to.mp3', 'sound/tom.mp3',
            'sound/so.mp3', 'sound/som.mp3',
            'sound/ve.mp3', 'sound/ver.mp3',
            'sound/ma.mp3', 'sound/mal.mp3',
            'sound/mes.mp3', 'sound/mas.mp3',
            'sound/fe.mp3', 'sound/pe.mp3',
            'sound/mau.mp3', 'sound/mar.mp3',
            'sound/cha.mp3', 'sound/ja.mp3',
            'sound/tia.mp3', 'sound/dia.mp3',
            'sound/ta.mp3', 'sound/da.mp3',
            'sound/fiz.mp3', 'sound/vis.mp3'
        ]
    };
    timeline.push(preload);

    
    const familiarization_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h2 style="text-align:center;">Familiarization Phase</h2>
            <p>Before starting the main experiment, you will complete a short practice session.</p>
            <p>This will help you become familiar with the task.</p>
            <p>Press any key to begin the practice trials.</p>
        `
    };
    timeline.push(familiarization_instructions);

    // Familiarization trials
    var familiarization_stimuli = [
        {stimulus: 'sound/fiz.mp3', choice1: 'Fiz', choice2: 'Vis', correct_resp: 0, type: 'familiarization'},
        {stimulus: 'sound/vis.mp3', choice1: 'Fiz', choice2: 'Vis', correct_resp: 1, type: 'familiarization'},
        
    ];

    var familiarization_trial = {
        type: jsPsychAudioButtonResponse,
        stimulus: jsPsych.timelineVariable('stimulus'),
        prompt: '<p style="font-size:200%"> Click on what you heard !</p>',
        response_allowed_while_playing: false,
        choices: function() {
            var choice1 = jsPsych.evaluateTimelineVariable('choice1');
            var choice2 = jsPsych.evaluateTimelineVariable('choice2');
            return [choice1, choice2];
        },
        button_html: function(choice) {
            return '<button class="jspsych-btn" style="font-size:400%">' + choice + '</button>';
        },
        post_trial_gap: 500,
        data: {
            correct_response: jsPsych.timelineVariable('correct_resp'),
            trial_type: jsPsych.timelineVariable('type'),
            choice1: jsPsych.timelineVariable('choice1'),
            choice2: jsPsych.timelineVariable('choice2')
        },
        on_finish: function(data){
            data.correct = data.response === data.correct_response;
            data.word_pair = data.choice1 + '/' + data.choice2;
        }
    };

    var familiarization_procedure = {
        timeline: [familiarization_trial],
        timeline_variables: familiarization_stimuli
    };
    timeline.push(familiarization_procedure);

    
    const main_experiment_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <h2 style="text-align:center;">Main Experiment</h2>
            <p>Great! You have completed the practice session.</p>
            <p>Now you will begin the main experiment.</p>
            <p>Press any key to start.</p>
        `
    };
    timeline.push(main_experiment_instructions);

    
    var items = [
        {stimulus: 'sound/la.mp3', choice1: 'Lá', choice2: 'Lã', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/la2.mp3', choice1: 'Lá', choice2: 'Lã', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/va.mp3', choice1: 'Vá', choice2: 'Vã', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/va2.mp3', choice1: 'Vá', choice2: 'Vã', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/si.mp3', choice1: 'Si', choice2: 'Sim', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/sim.mp3', choice1: 'Si', choice2: 'Sim', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/ri.mp3', choice1: 'Ri', choice2: 'Rim', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/rim.mp3', choice1: 'Ri', choice2: 'Rim', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/nu.mp3', choice1: 'Nu', choice2: 'Num', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/num.mp3', choice1: 'Nu', choice2: 'Num', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/tu.mp3', choice1: 'Tu', choice2: 'Tum', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/tum.mp3', choice1: 'Tu', choice2: 'Tum', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/se.mp3', choice1: 'Se', choice2: 'Sem', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/sem.mp3', choice1: 'Se', choice2: 'Sem', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/de.mp3', choice1: 'Dê', choice2: 'Dem', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/dem.mp3', choice1: 'Dê', choice2: 'Dem', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/to.mp3', choice1: 'Tô', choice2: 'Tom', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/tom.mp3', choice1: 'Tô', choice2: 'Tom', correct_resp: 1, type: 'item'},
        {stimulus: 'sound/so.mp3', choice1: 'So', choice2: 'Som', correct_resp: 0, type: 'item'},
        {stimulus: 'sound/som.mp3', choice1: 'So', choice2: 'Som', correct_resp: 1, type: 'item'}
    ];

    
    var fillers = [
        {stimulus: 'sound/ve.mp3', choice1: 'Vê', choice2: 'Ver', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/ver.mp3', choice1: 'Vê', choice2: 'Ver', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/ma.mp3', choice1: 'Má', choice2: 'Mal', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/mal.mp3', choice1: 'Má', choice2: 'Mal', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/cha.mp3', choice1: 'Chá', choice2: 'Já', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/ja.mp3', choice1: 'Chá', choice2: 'Já', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/fe.mp3', choice1: 'Fé', choice2: 'Pé', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/pe.mp3', choice1: 'Fé', choice2: 'Pé', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/mau.mp3', choice1: 'Mau', choice2: 'Mar', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/mar.mp3', choice1: 'Mau', choice2: 'Mar', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/mes.mp3', choice1: 'Mês', choice2: 'Mas', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/mas.mp3', choice1: 'Mês', choice2: 'Mas', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/tia.mp3', choice1: 'Tia', choice2: 'Dia', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/dia.mp3', choice1: 'Tia', choice2: 'Dia', correct_resp: 1, type: 'filler'},
        {stimulus: 'sound/ta.mp3', choice1: 'Tá', choice2: 'Dá', correct_resp: 0, type: 'filler'},
        {stimulus: 'sound/da.mp3', choice1: 'Tá', choice2: 'Dá', correct_resp: 1, type: 'filler'}
    ];

    
    var all_stimuli = items.concat(fillers);

    var stimuli_presented = {
        type: jsPsychAudioButtonResponse,
        stimulus: jsPsych.timelineVariable('stimulus'),
        prompt: '<p style="font-size:200%"> Click on what you heard !</p>',
        response_allowed_while_playing: false,
        choices: function() {
            var choice1 = jsPsych.evaluateTimelineVariable('choice1');
            var choice2 = jsPsych.evaluateTimelineVariable('choice2');
            return [choice1, choice2];
        },
        button_html: function(choice) {
            return '<button class="jspsych-btn" style="font-size:400%">' + choice + '</button>';
        },
        post_trial_gap: 500,
        data: {
            correct_response: jsPsych.timelineVariable('correct_resp'),
            trial_type: jsPsych.timelineVariable('type'),
            choice1: jsPsych.timelineVariable('choice1'),
            choice2: jsPsych.timelineVariable('choice2')
        },
        on_finish: function(data){
            data.correct = data.response === data.correct_response;
            data.word_pair = data.choice1 + '/' + data.choice2;
        }
    }

    var trial = {
        timeline: [stimuli_presented],
        timeline_variables: all_stimuli,
        randomize_order: true
    }
    timeline.push(trial);

    const instructions3 = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <p>Thank you for participating! </p> 
            <p>Please press any key and fill in the following box.</p>` 
    }
    timeline.push(instructions3);

    const demographics = {
        type: jsPsychSurveyHtmlForm,
        preamble: "<h3>Form</h3>",
        html: `<p>Thank you for participating! </p> 
               <p>Please fill in the following box.</p>
        <p>Languages you speak and level: <input type="text" name="languages" size="50" required /></p>`,
        button_label: "Send"
    };
    timeline.push(demographics);

    const final_instructions = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <p>Thank you!</p>
            <p>Click on the button below to download your data.</p>
        `,
        choices: ["Baixar dados"],
        on_finish: function () {
            jsPsych.data.get().localSave("csv", "dados_experimento.csv");
        }
    };

    timeline.push(final_instructions);

    jsPsych.run(timeline);
    
</script>
</html>